#!/usr/bin/env bash

# 
# a workaround because I don't like tauri's folder layout
# 
tauri_src="$FORNIX_FOLDER/workspace.ignore/src-tauri"
mkdir -p "$tauri_src"
ln -sf "../../.gitignore" "$tauri_src/"
ln -sf "../../settings/requirements/Cargo.toml" "$tauri_src/"
ln -sf "../../settings/requirements/Cargo.lock" "$tauri_src/"
ln -sf "../../rustfmt.toml" "$tauri_src/"
ln -sf "../../main/tauri.conf.json" "$tauri_src/"
ln -sf "../../main/frontend" "$tauri_src/"
ln -sf "../../main/icons" "$tauri_src/"
rm -f "$tauri_src/src"
ln -sf "../../main/backend" "$tauri_src/src"

# setup
cd "$tauri_src"
cargo install --path .

# build
cd "$tauri_src/.."
# cargo tauri icon src-tauri/app-icon.png
cargo tauri build --verbose "$@"